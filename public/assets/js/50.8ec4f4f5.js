(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{439:function(s,a,e){"use strict";e.r(a);var t=e(2),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"npm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm"}},[s._v("#")]),s._v(" NPM")]),s._v(" "),a("h2",{attrs:{id:"npmrc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npmrc"}},[s._v("#")]),s._v(" .npmrc")]),s._v(" "),a("p",[s._v("NPM的配置文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("registry")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://registry.npmjs.org/\npackage-lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不启用NPM锁")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),a("h3",{attrs:{id:"npm-config"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-config"}},[s._v("#")]),s._v(" npm config")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry https://registry.npmjs.org/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config get prefix \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config delete registry\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"npm-init"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-init"}},[s._v("#")]),s._v(" npm init")]),s._v(" "),a("p",[s._v("初始化"),a("code",[s._v("package.json")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" init -y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"npm-install"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-install"}},[s._v("#")]),s._v(" npm install")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --save "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yarn add <name>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --save-dev "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yarn add <name> -D")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yarn global add <name>")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ci "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通常用于CI，使用该命令时需要确保项目中存在 package-lock.json或 npm-shrinkwrap.json，并且当 package.json和 package-lock.json中依赖的版本不一致时 npm ci会抛出错误。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("本地安装时，模块会被安装在"),a("code",[s._v("/project/node_modules")]),s._v("下，同时如果该模块的"),a("code",[s._v("package.json")]),s._v("中存在"),a("code",[s._v("bin")]),s._v("字段时，则会自动根据"),a("code",[s._v("bin")]),s._v("表示的字典在"),a("code",[s._v("/project/node_modules/.bin")]),s._v("下面创建对应的符号链接。")]),s._v(" "),a("p",[s._v("全局安装时，模块会被安装在"),a("code",[s._v("/usr/local/lib/node_modules")]),s._v("（以MacOS举例）下，同时如果该模块的"),a("code",[s._v("package.json")]),s._v("中存在"),a("code",[s._v("bin")]),s._v("字段时，则会自动根据"),a("code",[s._v("bin")]),s._v("表示的字典在"),a("code",[s._v("/usr/local/bin")]),s._v("下面创建对应的符号链接（可理解为Windows中的快捷方式）。")]),s._v(" "),a("p",[s._v("举个例子，"),a("code",[s._v("akara-project")]),s._v("的"),a("code",[s._v("package.json")]),s._v("中的"),a("code",[s._v("bin")]),s._v("字段如下，那么当全局安装"),a("code",[s._v("akara-project")]),s._v("时会创建"),a("code",[s._v("/usr/local/bin/akara")]),s._v("这个文件（符号链接），这个文件实际指向着"),a("code",[s._v("akara-project")]),s._v("根路径下的"),a("code",[s._v("index.js")]),s._v("。（其实这就是开发命令行工具的原理）")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"bin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"akara"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.js"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"npm-uninstall"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-uninstall"}},[s._v("#")]),s._v(" npm uninstall")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" uninstall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yarn remove <name>")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"npm-update"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-update"}},[s._v("#")]),s._v(" npm update")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yarn upgrade <name>")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" update\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("举个例子，如果我们的项目（采用锁机制）存在老版本的"),a("code",[s._v("react@^16.0.0")]),s._v("，此时我们（包括CI）只能拿到"),a("code",[s._v("16.0.0")]),s._v("版本的"),a("code",[s._v("react")]),s._v("。如果我们现在想要升级"),a("code",[s._v("react")]),s._v("可以采取两种方式："),a("code",[s._v("npm install react")]),s._v("或"),a("code",[s._v("npm update react")]),s._v("。前者更类似于重新安装"),a("code",[s._v("react")]),s._v("，并会重写"),a("code",[s._v("package.json")]),s._v("中的依赖关系；而"),a("code",[s._v("npm update")]),s._v("并不会改动"),a("code",[s._v("package.json")]),s._v("，它仅仅是根据"),a("code",[s._v("package.json")]),s._v("中的版本"),a("code",[s._v("semver")]),s._v("来重新安装可安装的最新"),a("code",[s._v("react")]),s._v("。二者都会重新生成"),a("code",[s._v("package-lock.json")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"npm-outdated"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-outdated"}},[s._v("#")]),s._v(" npm outdated")]),s._v(" "),a("p",[s._v("查看项目中哪些模块不是最新版本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" outdated \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"npm-run"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-run"}},[s._v("#")]),s._v(" npm run")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run start "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行脚本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run-script "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("stage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"npm-link"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-link"}},[s._v("#")]),s._v(" npm link")]),s._v(" "),a("blockquote",[a("p",[s._v("alias: npm ln")])]),s._v(" "),a("p",[s._v("简单来说这个命令存在两种用法，可用于将本地模块链接到全局，或是将全局模块链接到本地。")]),s._v(" "),a("p",[s._v("用法一：")]),s._v(" "),a("p",[s._v("当我们位于模块"),a("code",[s._v("akara-project")]),s._v("项目中时，直接执行"),a("code",[s._v("npm link")]),s._v("会把当前模块链接到全局（具体来说的话，会在"),a("code",[s._v("/usr/local/lib/node_modules")]),s._v("下创建一个符号链接指向着"),a("code",[s._v("akara-project")]),s._v("这个模块，如果该模块的"),a("code",[s._v("package.json")]),s._v("存在"),a("code",[s._v("bin")]),s._v("字段时还会在"),a("code",[s._v("/usr/local/bin")]),s._v("下面创建对应的符号链接）")]),s._v(" "),a("p",[s._v("用法二：")]),s._v(" "),a("p",[s._v("当我们位于某个项目中时，并假设我们已经全局安装了一个模块（如"),a("code",[s._v("pm2")]),s._v("），此时在项目中执行"),a("code",[s._v("npm link webpack")]),s._v("会把全局模块链接到本地（具体来说的话，会在当前项目的"),a("code",[s._v("node_modules")]),s._v("创建一个符号链接"),a("code",[s._v("pm2")]),s._v("指向着全局的"),a("code",[s._v("pm2")]),s._v("模块，如果该模块的"),a("code",[s._v("package.json")]),s._v("存在"),a("code",[s._v("bin")]),s._v("字段时还会在"),a("code",[s._v("/project/node_modules/.bin")]),s._v("下面创建对应的符号链接）")]),s._v(" "),a("p",[s._v("通过结合方法一和方法二我们可以实现这样的功能：假设我们同时维护着项目A和模块B，并在项目A中引用着模块B。那么比较传统的方法来维护这两个库是这样的，更新完模块B后发布，然后在项目A中更新模块B从而查看最新的效果；而通过"),a("code",[s._v("npm link")]),s._v("我们可以简化这个流程，我们只需要先在B模块中通过"),a("code",[s._v("npm link")]),s._v("来把B模块链接到全局，然后在A项目中通过"),a("code",[s._v("npm link B")]),s._v("来把全局B模块链接到A项目本地。")]),s._v(" "),a("h3",{attrs:{id:"npm-exec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-exec"}},[s._v("#")]),s._v(" npm exec")]),s._v(" "),a("p",[s._v("可以直接执行"),a("code",[s._v("node_modules/.bin")]),s._v("下的可执行文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" webpack "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等于npx webpack")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"npm-publish"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-publish"}},[s._v("#")]),s._v(" npm publish")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布模块")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" unpublish --force "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下架模块")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" publish --access publish "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布公共模块")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("在通过"),a("code",[s._v("npm login")]),s._v("登陆了"),a("code",[s._v("npm")]),s._v("账户后，我们可以在任意项目下通过"),a("code",[s._v("npm publish")]),s._v("来进行模块的发布，此时NPM镜像源需要是官方镜像源。")]),s._v(" "),a("p",[s._v("除了通常的模块，我们还可以发布类似"),a("code",[s._v("@akara/my-package")]),s._v("这样的作用域模块，此时我们需要"),a("code",[s._v("npm publish --access publish")]),s._v("。这是因为NPM模块分为公共模块和私有模块，通常我们发布的都是公共模块，而发布私有模块是收费的，同时发布作用域模块默认是发布私有模块，因此我们需要显式的制定模块的类型。")]),s._v(" "),a("p",[s._v("发布NPM模块时，"),a("code",[s._v(".gitignore")]),s._v("和"),a("code",[s._v(".npmignore")]),s._v("中指定的文件不会被发布出去。除此之外我们还可以通过"),a("code",[s._v("package.json")]),s._v("的"),a("code",[s._v("files")]),s._v("来指定只有哪些文件能被发布。")]),s._v(" "),a("ol",[a("li",[a("code",[s._v(".gitignore")]),s._v("中的文件不会被发布")]),s._v(" "),a("li",[a("code",[s._v(".npmignore")]),s._v("中的文件不会被发布")]),s._v(" "),a("li",[a("code",[s._v("package.json")]),s._v("中的 "),a("code",[s._v("files")]),s._v("字段指定哪些文件会被发布")])]),s._v(" "),a("h3",{attrs:{id:"npm-view"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-view"}},[s._v("#")]),s._v(" npm view")]),s._v(" "),a("p",[s._v("查看一个模块的信息")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" view "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# e.g npm view antd")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"npm-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-version"}},[s._v("#")]),s._v(" npm version")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version patch "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 升级一个补丁版本，同时自动git commit并打上版本号对应的git tag，如v1.0.1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version minor "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 升级一个小版本，如v1.1.1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version major "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 升级一个大版本，如v2.0.0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"npm-audit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-audit"}},[s._v("#")]),s._v(" npm audit")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" audit "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前项目所有依赖模块的漏洞")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" audit --fix "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新所有存在漏洞的模块来修复漏洞")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("当我们安装模块时会自动提示当前版本的模块的漏洞，我们也可以通过该命令来查找当前项目所有依赖中可能存在的漏洞")]),s._v(" "),a("h3",{attrs:{id:"npm-fund"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-fund"}},[s._v("#")]),s._v(" npm fund")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" fund\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("当我们安装模块时会自动提示有多少个模块正在寻找投资/资助，我们也可以通过该命令来查看具体是哪些命令在寻找投资")]),s._v(" "),a("h2",{attrs:{id:"package-json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#package-json"}},[s._v("#")]),s._v(" package.json")]),s._v(" "),a("h3",{attrs:{id:"type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#type"}},[s._v("#")]),s._v(" type")]),s._v(" "),a("p",[s._v("以"),a("code",[s._v(".cjs")]),s._v("结尾的文件会被视为"),a("code",[s._v("CommonJS")]),s._v("模块，以"),a("code",[s._v(".mjs")]),s._v("结尾的文件会被视为"),a("code",[s._v("ES")]),s._v("模块，而普通的"),a("code",[s._v(".js")]),s._v("文件则会根据"),a("code",[s._v("type")]),s._v("字段的不同视为不同的模块，默认不带"),a("code",[s._v("type")]),s._v("视为"),a("code",[s._v("CommonJS")]),s._v("模块，"),a("code",[s._v("type: 'module'")]),s._v("则视为"),a("code",[s._v("ES")]),s._v("模块。")]),s._v(" "),a("h3",{attrs:{id:"files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#files"}},[s._v("#")]),s._v(" files")]),s._v(" "),a("p",[s._v("对于一些模块而言，用户只需要引用该模块源码构建后的产物，而并不想连源代码也一起安装。这样的模块通常会通过"),a("code",[s._v("files")]),s._v("字段来规定哪些模块才会被发布，如"),a("code",[s._v('"file": ["dist", "README.md"]')])]),s._v(" "),a("p",[s._v("需要注意的是以下文件永远都会被外部下载："),a("code",[s._v("package.json")]),s._v("、"),a("code",[s._v("README")]),s._v("、"),a("code",[s._v("CHANGE / CHANGELOG / HISTORY")]),s._v("、"),a("code",[s._v("LICENSE / LICENCE")]),s._v("、"),a("code",[s._v("NOTICE")]),s._v("、"),a("code",[s._v("main")]),s._v("字段指向的文件。")]),s._v(" "),a("h3",{attrs:{id:"main"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#main"}},[s._v("#")]),s._v(" main")]),s._v(" "),a("p",[s._v("用来规定模块的默认入口，默认值为 "),a("code",[s._v("index.js")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" test "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'my-module'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 引入my-module模块的根目录的index.js文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"exports"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exports"}},[s._v("#")]),s._v(" exports")]),s._v(" "),a("p",[s._v("功能类似"),a("code",[s._v("main")]),s._v("，同时存在"),a("code",[s._v("exports")]),s._v("和"),a("code",[s._v("main")]),s._v("时，"),a("code",[s._v("exports")]),s._v("字段的优先级更高")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"exports"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"."')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"./test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src/test.js"')]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" test "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'my-module'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ./index.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" test2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'my-module/test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ./src/test.js")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("可以看到一旦使用了"),a("code",[s._v("exports")]),s._v("字段，那么模块的引用规则就和以往有较大的区别，此时我们不再能根据模块的任意路径来引用相对应的文件，只能根据"),a("code",[s._v("exports")]),s._v("所指定的映射关系来引用所给定的文件。")]),s._v(" "),a("p",[a("code",[s._v("exports")]),s._v("还能够根据导入模块时使用的是 "),a("code",[s._v("require")]),s._v("还是 "),a("code",[s._v("import")]),s._v("选择不同的导出。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"exports"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"."')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"require"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./a.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"import"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./b.mjs"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"bin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bin"}},[s._v("#")]),s._v(" bin")]),s._v(" "),a("p",[s._v("如之前说过那样，当我们通过"),a("code",[s._v("npm install")]),s._v("安装模块时，会根据该模块"),a("code",[s._v("package.json")]),s._v("中的"),a("code",[s._v("bin")]),s._v("字段来创建指向指定文件的符号链接")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"bin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"akara"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.js"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("假设"),a("code",[s._v("akara-project")]),s._v("的配置如上，那么全局安装"),a("code",[s._v("akara-project")]),s._v("时会创建"),a("code",[s._v("/usr/local/bin/akara")]),s._v("符号链接（指向着"),a("code",[s._v("/usr/local/lib/node_modules/akara-project/index.js")]),s._v("），所以现在我们可以直接在命令行中输入"),a("code",[s._v("akara")]),s._v("来执行对应的"),a("code",[s._v("index.js")]),s._v("（当然实际上我们还需要两个小步骤，一是我们需要规定"),a("code",[s._v("index.js")]),s._v("这个文件执行的环境，因此需要在"),a("code",[s._v("index.js")]),s._v("代码的第一行加上"),a("code",[s._v("#!/usr/bin/env node")]),s._v("；二是我们需要通过执行"),a("code",[s._v("chmod +x index.js")]),s._v("来给予该文件可执行权限）")]),s._v(" "),a("p",[s._v("如果我们是本地安装而不是全局安装"),a("code",[s._v("akara-project")]),s._v("，那么创建的符号链接"),a("code",[s._v("akara")]),s._v("会被放在"),a("code",[s._v("project/node_modules/.bin")]),s._v("下面，此时无法直接通过在命令行输入"),a("code",[s._v("akara")]),s._v("来执行命令，我们有其他的几种方式")]),s._v(" "),a("ol",[a("li",[a("p",[a("code",[s._v("./node_modules/.bin/akara")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("package.json")]),s._v("的 "),a("code",[s._v("script")]),s._v("字段中填写执行方式，如")]),s._v(" "),a("div",{staticClass:"language-1 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{\n    "script": {\n        "run-my-script": "akara"\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("npm exec akara")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("npx akara")])])])]),s._v(" "),a("h3",{attrs:{id:"script"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#script"}},[s._v("#")]),s._v(" script")]),s._v(" "),a("p",[a("code",[s._v("npm")]),s._v("除了 "),a("code",[s._v("npm ci")]),s._v("、"),a("code",[s._v("npm install")]),s._v("等内置脚本，还包括 "),a("code",[s._v("hook script")]),s._v("（"),a("code",[s._v("pre/post script）")]),s._v("和 "),a("code",[s._v("lifecycle script")]),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"pre-post"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pre-post"}},[s._v("#")]),s._v(" pre & Post")]),s._v(" "),a("p",[s._v("对于一个脚本我们可能想要在其执行之前或之后执行某些操作，此时可以使用 "),a("code",[s._v("pre")]),s._v("或 "),a("code",[s._v("post")]),s._v("前缀。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo \\"i\'m test\\""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pretest"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo \\"在test脚本执行前执行\\""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"posttest"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo \\"在test脚本执行后执行\\""')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"lifecycle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lifecycle"}},[s._v("#")]),s._v(" LifeCycle")]),s._v(" "),a("p",[a("code",[s._v("npm")]),s._v("内置了一些生命周期脚本，如"),a("code",[s._v("prepare")]),s._v("、"),a("code",[s._v("prepack")]),s._v("等")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"prepare"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo \\"hello akara\\""')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"dependencies"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dependencies"}},[s._v("#")]),s._v(" dependencies")]),s._v(" "),a("p",[s._v("项目的依赖")]),s._v(" "),a("h3",{attrs:{id:"devdependencies"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#devdependencies"}},[s._v("#")]),s._v(" devDependencies")]),s._v(" "),a("p",[s._v("项目的开发依赖。如果我们在NPM发布了一个模块A，之后当我们 "),a("code",[s._v("npm install A")]),s._v("时会自动安装模块A的依赖，但不会安装模块A的开发依赖。")]),s._v(" "),a("h3",{attrs:{id:"peerdependencies"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#peerdependencies"}},[s._v("#")]),s._v(" peerDependencies")]),s._v(" "),a("p",[s._v("\b假设存在A库，该库存在一个插件B，那么很明显插件B自身是不依赖于库A的，但是又需要你的项目中存在库A，那么插件B的 "),a("code",[s._v("package.json")]),s._v("中就可以通过 "),a("code",[s._v("peerDependencies")]),s._v("来指定同级依赖关系。比如插件B只能在1.0版本的A库中起作用，那么 "),a("code",[s._v("peerDependencies")]),s._v("可能是 "),a("code",[s._v("A@1.0.0")]),s._v("，当你的项目中同时安装了插件B和2.0版本的A库时就会出现警告。")]),s._v(" "),a("h3",{attrs:{id:"resolutions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resolutions"}},[s._v("#")]),s._v(" resolutions")]),s._v(" "),a("p",[s._v("假设我们项目直接依赖"),a("code",[s._v("react-router")]),s._v("，而"),a("code",[s._v("react-router")]),s._v("内部又依赖"),a("code",[s._v("@types/react: '*'")]),s._v("。这意味着当我们安装"),a("code",[s._v("react-router")]),s._v("时会自动安装最新版本的"),a("code",[s._v("@types/react")]),s._v("，又已知最新版本的"),a("code",[s._v("@types/react")]),s._v("（比如"),a("code",[s._v("v18")]),s._v("）引入了一些破坏性变更，我们此时希望能够安装更低版本的"),a("code",[s._v("@types/react")]),s._v("来避免错误提示，这个时候可以给"),a("code",[s._v("package.json")]),s._v("添加"),a("code",[s._v("resolutions")]),s._v("字段，并通过"),a("code",[s._v("yarn install")]),s._v("重新安装。"),a("a",{attrs:{href:"https://classic.yarnpkg.com/lang/en/docs/selective-version-resolutions/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Selective dependency resolutions"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  resolutions"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    '@types/react'"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" '^"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.0")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("'\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"browser-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#browser-module"}},[s._v("#")]),s._v(" browser | module")]),s._v(" "),a("p",[s._v("一般 "),a("code",[s._v("browser")]),s._v("字段指向 "),a("code",[s._v("cjs")]),s._v("或 "),a("code",[s._v("umd")]),s._v("模块，"),a("code",[s._v("module")]),s._v("字段指向 "),a("code",[s._v("es")]),s._v("模块，大多数情况下这两个字段都没什么用处。")]),s._v(" "),a("p",[s._v("在某些情况下，特别是使用 "),a("code",[s._v("webpack")]),s._v("打包模块时，当 "),a("code",[s._v("webpack")]),s._v("配置的 "),a("code",[s._v("target")]),s._v("为 "),a("code",[s._v("web")]),s._v("（默认值），会根据模块的 "),a("code",[s._v("browser")]),s._v("字段导入模块；通过设置 "),a("code",[s._v("target")]),s._v("为 "),a("code",[s._v("node")]),s._v("，会根据 "),a("code",[s._v("module")]),s._v("字段导入模块。")]),s._v(" "),a("p",[s._v("另外，当 "),a("code",[s._v("package.json")]),s._v("不存在对应的入口字段，会根据 "),a("code",[s._v("browser -> module -> main")]),s._v("的优先级导入模块。这个优先级是根据配置 "),a("code",[s._v("resolve.mainFields")]),s._v("字段指定的，我们可以通过修改该字段来调整优先级：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack.config.js")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 默认值web")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("resolve")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("mainFields")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'module'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'browser'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 默认值 ['browser', 'module', 'main']")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"package-lock-json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#package-lock-json"}},[s._v("#")]),s._v(" package-lock.json")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("package.json")]),s._v("的 "),a("code",[s._v("dependencies")]),s._v("字段中我们经常能看见这种形式的版本号 "),a("code",[s._v('"react": "^17.0.2"')]),s._v("、"),a("code",[s._v('"xx": "~0.10.0"')]),s._v("，这种写法通常被称为"),a("a",{attrs:{href:"https://github.com/npm/node-semver",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("semver")]),s._v("表示法"),a("OutboundLink")],1),s._v("，三个数字分别表示主要版本、次要版本、补丁版本。")]),s._v(" "),a("p",[s._v("当我们使用 "),a("code",[s._v("npm install <name>")]),s._v("来安装依赖，或者是在已有的项目中使用 "),a("code",[s._v("npm update")]),s._v("来更新依赖，都会根据 "),a("code",[s._v("semver")]),s._v("规则安装对应版本的模块，也就是说"),a("strong",[s._v("实际安装版本并不是固定的")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("^")]),s._v("：表示只会执行不更改最左边非零数字的更新。比如 "),a("code",[s._v("^0.10.0")]),s._v("，意味着我们可以安装（或更新，下同）"),a("code",[s._v("0.10.1")]),s._v("等版本，但不能安装 "),a("code",[s._v("0.11.0")]),s._v("或更高的版本；又比如 "),a("code",[s._v("^1.10.0")]),s._v("，意味着我们可以安装 "),a("code",[s._v("1.10.1")]),s._v("、"),a("code",[s._v("1.11.0")]),s._v("等版本，但不能安装 "),a("code",[s._v("2.0.0")]),s._v("或更高的版本。")]),s._v(" "),a("li",[a("code",[s._v("~")]),s._v("：如果我在比较器中指定了次要版本，那么只允许补丁版本的更新；如果没有指定次要版本，那么可以允许次要版本的更新，所以通常情况 "),a("code",[s._v("~")]),s._v("只允许补丁级别的更新。比如 "),a("code",[s._v("~1.10.0")]),s._v("的依赖，意味着我们只能安装 "),a("code",[s._v("1.10.x")]),s._v("的版本，不能安装 "),a("code",[s._v("1.11.0")]),s._v("的版本。")])]),s._v(" "),a("p",[s._v("而这也带来了一个新的问题，对于同一个项目在不同时机安装的依赖版本可能不一致，这就带来了相当大的风险和不可控性，特别是当依赖的某个包更新了一个漏洞，那也会影响到我们新构建的代码。")]),s._v(" "),a("p",[s._v("因此高版本"),a("code",[s._v("yarn")]),s._v("和"),a("code",[s._v("npm")]),s._v("都默认启用了"),a("code",[s._v("lock")]),s._v("机制，当我们"),a("code",[s._v("npm install <name>")]),s._v("安装依赖或"),a("code",[s._v("npm update")]),s._v("更新依赖的时候都会生成"),a("code",[s._v("package-lock.json")]),s._v("（"),a("code",[s._v("yarn")]),s._v("对应"),a("code",[s._v("yarn.lock")]),s._v("），那当其他人"),a("code",[s._v("clone")]),s._v("项目并"),a("code",[s._v("npm install")]),s._v("时则会根据"),a("code",[s._v("package-lock.json")]),s._v("来安装指定版本的模块。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("不过很明显锁不锁版本都有对应的好处和坏处，所以社区对是否锁版本还存在着一些"),a("a",{attrs:{href:"https://www.zhihu.com/question/65536076",target:"_blank",rel:"noopener noreferrer"}},[s._v("争论"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("另外，无论是否使用 "),a("code",[s._v("lock")]),s._v("机制，都不应该把 "),a("code",[s._v("package-lock.json")]),s._v("写入 "),a("code",[s._v(".gitignore")]),s._v("中。")]),s._v(" "),a("p",[s._v("如果我们使用 "),a("code",[s._v("lock")]),s._v("机制，应该直接把 "),a("code",[s._v("package-lock.json")]),s._v("提交进仓库；如果我们不使用 "),a("code",[s._v("lock")]),s._v("机制，则应该在 "),a("code",[s._v(".npmrc")]),s._v("中写入 "),a("code",[s._v("package-lock=false")]),s._v("来关闭 "),a("code",[s._v("lock")]),s._v("机制，并把 "),a("code",[s._v("package-lock.json")]),s._v("提交到仓库中。"),a("a",{attrs:{href:"https://www.zhihu.com/question/264560841",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"node-modules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-modules"}},[s._v("#")]),s._v(" node_modules")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("NPM")]),s._v("的早期版本，"),a("code",[s._v("node_modules")]),s._v("使用嵌套结构来管理模块之间的依赖关系。而我们的很多模块都又可能依赖于同一个模块，这样的结构可能导致性能的浪费。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- A -> B\n- C -> B\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("所以在 "),a("code",[s._v("NPM@3.x")]),s._v("以后，"),a("code",[s._v("node_modules")]),s._v("主要使用扁平结构来管理模块之间的依赖关系。假设我们安装了A和C模块，这两个模块同时依赖于同一个版本的B模块，此时 "),a("code",[s._v("node_modules")]),s._v("结构如下。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- A\n- C\n- B\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("不过有的时候，我们安装的模块A和C可能依赖于同一个模块B的不同版本。")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("假设 "),a("code",[s._v("node_modules")]),s._v("存在 "),a("code",[s._v("B@1.1.0")]),s._v("。然后我们安装的模块A依赖于 "),a("code",[s._v("B@^1.1.0")]),s._v("，即使模块B最新版本已经到了 "),a("code",[s._v("1.9.0")]),s._v("，我们也会复用原本已安装的模块。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- A\n- B@1.1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("假设 "),a("code",[s._v("node_modules")]),s._v("存在 "),a("code",[s._v("B@1.1.0")]),s._v("。然后我们安装的模块A依赖于 "),a("code",[s._v("B@^1.2.0")]),s._v("，则会安装最新的模块（如 "),a("code",[s._v("B@1.9.0")]),s._v("）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- A -> B@1.9.0 \n- B@1.1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);